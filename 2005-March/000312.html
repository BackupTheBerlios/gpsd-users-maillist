<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Gpsd-users] Multi-session semantics
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/gpsd-users/2005-March/index.html" >
   <LINK REL="made" HREF="mailto:gpsd-users%40lists.berlios.de?Subject=Re%3A%20%5BGpsd-users%5D%20Multi-session%20semantics&In-Reply-To=%3C200503112059.j2BKxxkD024153%40snark.thyrsus.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000309.html">
   <LINK REL="Next"  HREF="000314.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gpsd-users] Multi-session semantics</H1>
    <B>Eric S. Raymond</B> 
    <A HREF="mailto:gpsd-users%40lists.berlios.de?Subject=Re%3A%20%5BGpsd-users%5D%20Multi-session%20semantics&In-Reply-To=%3C200503112059.j2BKxxkD024153%40snark.thyrsus.com%3E"
       TITLE="[Gpsd-users] Multi-session semantics">esr at snark.thyrsus.com
       </A><BR>
    <I>Fri Mar 11 21:59:59 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000309.html">[Gpsd-users] DGPS/WAAS/EGNOS/SBAS support
</A></li>
        <LI>Next message: <A HREF="000314.html">[Gpsd-users] Re: Multi-session semantics
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#312">[ date ]</a>
              <a href="thread.html#312">[ thread ]</a>
              <a href="subject.html#312">[ subject ]</a>
              <a href="author.html#312">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>gpsd has been evolving away from being a simple device monitor towards
being a persistent agent whose job it is to impedance-match between
GPSes and applications (one which may talk to several devices in its
lifetime).  Steps in this evolution have been:

1. Automatic device reconnect, which already almost worked in 1.10.

2. The X command reporting on whether a GPS is available.

3. The B command allowing a client to change the connection baud rate.

4. The F command allowing GPS to switch devices when only the
   switch-requesting client is active.

An issue that came up in my conversation with David Zeuthen is that
HAL would (at least philosophically) like to support *multiple* GPSes.
Whether HAL integration happens or not, this started me thinking about
multi-GPS support in gpsd.

Implementing multi-GPS support would not be a large problem.  One
of my major goals in re-architecting the daemon code was to turn as
much of it as possible into a re-entrant library keeping its data in a
single session structure.  I achieved this so completely that the
entire daemon has only eight global variables, all of them visible
only within gpsd.c.  Of these, only two are potentially per-session.

At the implementation level, then, gpsd is already close to being
multi-GPS-ready. The real problem is at design level.  We need to
figure out what the right lifetime rules for GPS sessions should be.

At the moment, a GPS session begins when the first client connects.  The
daemon takes this as a cue to open the current GPS device, which may
have been set by the command-line -f option or an F command (the F
command will usually have been generated by a hotplug script).  When
the last client exits, the GPS device is closed and the session ends.   

There are two rules about F commands:

1. An F command fails if probing the specified device does not
confirm it is a GPS.  gpsd reverts to the previous device.

2. An F command also fails if there is more than one client attached.

3, All client sessions talk to the device, the one specified by the
   last successful F command.

The effect of the combination of these rules is to prevent
denial-of-service attacks.  They mean that a rogue client cannot
prevent other processes from getting GPS service by pointing
gpsd at a bogus device.  A rogue client cannot even change 
which device another client sees.

Now, suppose we want to support multiple clients talking to multiple
GPSes using just one instance of gpsd?  The reason to want this is
that, ideally, access to all GPSes should go through the same
well-known port.  Also, a multi-session gpsd would be convenient for
supporting multiple GPSes in HAL.

Rule 1 would still still good.  But now we want a client to be able to switch
to a new device without affecting other clients, so rules 3 and 2 break.

We can't just use F for device switching, because hotplug scripts
need it in order to tell gpsd when a new device is available for
*all* clients.  F will need to have the semantics &quot;add a GPS to gpsd's
internal search list (and switch this client to use that GPS)&quot;.  

We'll need to have a new command that removes a GPS from the GPS list
(hotplug scripts will use it to cue gpsd on a remove event).  For the
sake of the discussion, let's name that command K.

The interesting questions are these: 

(1) When a client connects to gpsd, and more than one GPS is hot, 
    which one does it get by default?

(2) What should happen to a client session when its GPS gets unplugged 
    *and other devices are available*?

Still to come:

* Subsecond polling

* Does the GPSD protocol need to be redesigned?
-- 
		&lt;a href=&quot;<A HREF="http://www.catb.org/~esr/">http://www.catb.org/~esr/</A>&quot;&gt;Eric S. Raymond&lt;/a&gt;

Never could an increase of comfort or security be a sufficient good to be
bought at the price of liberty.		-- Hillaire Belloc

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000309.html">[Gpsd-users] DGPS/WAAS/EGNOS/SBAS support
</A></li>
	<LI>Next message: <A HREF="000314.html">[Gpsd-users] Re: Multi-session semantics
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#312">[ date ]</a>
              <a href="thread.html#312">[ thread ]</a>
              <a href="subject.html#312">[ subject ]</a>
              <a href="author.html#312">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/gpsd-users">More information about the Gpsd-users
mailing list</a><br>
</body></html>
